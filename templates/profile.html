{% extends "horizontal_base.html" %}

{% block title %}个人中心{% endblock title %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center flex-wrap grid-margin">
        <div>
            <h4 class="mb-3 mb-md-0">个人中心</h4>
        </div>
        <div class="d-flex align-items-center flex-wrap text-nowrap">
            <a href="{% url 'accounts:profile_edit' %}" class="btn btn-primary btn-icon-text mb-2 mb-md-0">
                <i data-lucide="edit" class="btn-icon-prepend"></i> 编辑资料
            </a>
        </div>
    </div>
    <div class="row">
        <div class="col-12 col-xl-12 stretch-card">
            <div class="row flex-grow-1">
                <!-- 基本信息卡片 -->
                <div class="col-md-6 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i data-lucide="user" class="icon-sm"></i> 基本信息
                            </h6>
                            <div class="row">
                                <div class="col-6 col-md-12 col-xl-6 mb-3">
                                    <label class="text-muted small">用户名</label>
                                    <p class="mb-0 fw-bold">{{ user.username }}</p>
                                </div>
                                <div class="col-6 col-md-12 col-xl-6 mb-3">
                                    <label class="text-muted small">邮箱</label>
                                    <p class="mb-0 fw-bold text-break">{{ user.email|default:"未设置" }}</p>
                                </div>
                                <div class="col-6 col-md-12 col-xl-6 mb-3">
                                    <label class="text-muted small">注册时间</label>
                                    <p class="mb-0">{{ user.date_joined|date:"Y年m月d日" }}</p>
                                </div>
                                <div class="col-6 col-md-12 col-xl-6 mb-3">
                                    <label class="text-muted small">最后登录</label>
                                    <p class="mb-0">{{ user.last_login|date:"Y年m月d日 H:i"|default:"首次登录" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 个人资料卡片 -->
                <div class="col-md-6 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i data-lucide="id-card" class="icon-sm"></i> 个人资料
                            </h6>
                            {% if profile.bio or profile.birth_date or profile.company or profile.location %}
                                <div class="row">
                                    {% if profile.bio %}
                                        <div class="col-12 mb-3">
                                            <label class="text-muted small">个人简介</label>
                                            <p class="mb-0">{{ profile.bio }}</p>
                                        </div>
                                    {% endif %}
                                    {% if profile.birth_date %}
                                        <div class="col-6 mb-3">
                                            <label class="text-muted small">生日</label>
                                            <p class="mb-0">{{ profile.birth_date|date:"Y年m月d日" }}</p>
                                        </div>
                                    {% endif %}
                                    {% if profile.company %}
                                        <div class="col-6 mb-3">
                                            <label class="text-muted small">公司</label>
                                            <p class="mb-0">{{ profile.company }}</p>
                                        </div>
                                    {% endif %}
                                    {% if profile.location %}
                                        <div class="col-12 mb-3">
                                            <label class="text-muted small">位置</label>
                                            <p class="mb-0">
                                                <i data-lucide="map-pin" class="icon-sm"></i> {{ profile.location }}
                                            </p>
                                        </div>
                                    {% endif %}
                                </div>
                            {% else %}
                                <p class="text-muted">暂无个人资料信息</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <!-- 社交链接卡片 -->
                {% if profile.github_url or profile.homepage_url or profile.blog_url or profile.twitter_url or profile.linkedin_url %}
                    <div class="col-md-6 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i data-lucide="link" class="icon-sm"></i> 社交链接
                                </h6>
                                <div class="d-flex flex-wrap gap-2">
                                    {% if profile.github_url %}
                                        <a href="{{ profile.github_url }}" target="_blank" class="btn btn-outline-dark btn-sm btn-icon-text">
                                            <i data-lucide="github" class="btn-icon-prepend"></i> GitHub
                                        </a>
                                    {% endif %}
                                    {% if profile.homepage_url %}
                                        <a href="{{ profile.homepage_url }}" target="_blank" class="btn btn-outline-primary btn-sm btn-icon-text">
                                            <i data-lucide="home" class="btn-icon-prepend"></i> 主页
                                        </a>
                                    {% endif %}
                                    {% if profile.blog_url %}
                                        <a href="{{ profile.blog_url }}" target="_blank" class="btn btn-outline-success btn-sm btn-icon-text">
                                            <i data-lucide="book-open" class="btn-icon-prepend"></i> 博客
                                        </a>
                                    {% endif %}
                                    {% if profile.twitter_url %}
                                        <a href="{{ profile.twitter_url }}" target="_blank" class="btn btn-outline-info btn-sm btn-icon-text">
                                            <i data-lucide="twitter" class="btn-icon-prepend"></i> Twitter
                                        </a>
                                    {% endif %}
                                    {% if profile.linkedin_url %}
                                        <a href="{{ profile.linkedin_url }}" target="_blank" class="btn btn-outline-primary btn-sm btn-icon-text">
                                            <i data-lucide="linkedin" class="btn-icon-prepend"></i> LinkedIn
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <!-- 我的积分卡片 -->
                <div class="col-md-6 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i data-lucide="award" class="icon-sm"></i> 我的积分
                            </h6>
                            <div class="d-flex justify-content-between align-items-baseline mb-2">
                                <h2 class="mb-0">{{ user.total_points }}</h2>
                                <a href="{% url 'points:my_points' %}" class="btn btn-sm btn-primary btn-icon-text">
                                    <i data-lucide="list" class="btn-icon-prepend"></i> 查看详情
                                </a>
                            </div>
                            <p class="text-muted">当前积分余额</p>
                            {% if user.withdrawable_points > 0 %}
                                <div class="alert alert-success d-flex align-items-center mb-3" role="alert">
                                    <i data-lucide="wallet" class="icon-sm me-2"></i>
                                    <div>
                                        <strong>可提现积分:</strong> {{ user.withdrawable_points }}
                                    </div>
                                </div>
                            {% endif %}
                            {% if user.get_points_by_tag %}
                                <div class="mt-3">
                                    <div class="d-flex flex-wrap gap-2">
                                        {% for item in user.get_points_by_tag %}
                                            <span class="badge {% if item.withdrawable %}bg-success{% else %}bg-primary{% endif %}">
                                                {{ item.tag }}: {{ item.points }}
                                                {% if item.withdrawable %}<i data-lucide="check-circle" class="icon-xs ms-1"></i>{% endif %}
                                            </span>
                                        {% endfor %}
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <i data-lucide="info" class="icon-xs"></i>
                                            绿色标签表示可提现积分
                                        </small>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <!-- 工作经历卡片 -->
                {% if profile.work_experiences.all %}
                    <div class="col-md-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i data-lucide="briefcase" class="icon-sm"></i> 工作经历
                                </h6>
                                {% for work in profile.work_experiences.all %}
                                    <div class="d-flex justify-content-between {% if not forloop.last %}mb-3 pb-3 border-bottom{% endif %}">
                                        <div class="d-flex">
                                            <i data-lucide="circle" class="icon-md text-primary me-2"></i>
                                            <div>
                                                <h6 class="mb-1">{{ work.title }}</h6>
                                                <p class="text-muted mb-1">{{ work.company_name }}</p>
                                                {% if work.description %}
                                                    <p class="mb-0 text-muted tx-13">{{ work.description }}</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="text-muted tx-13">
                                            {{ work.start_date|date:"Y年m月" }} -
                                            {% if work.end_date %}
                                                {{ work.end_date|date:"Y年m月" }}
                                            {% else %}
                                                至今
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                <!-- 学习经历卡片 -->
                {% if profile.educations.all %}
                    <div class="col-md-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i data-lucide="graduation-cap" class="icon-sm"></i> 学习经历
                                </h6>
                                {% for edu in profile.educations.all %}
                                    <div class="d-flex justify-content-between {% if not forloop.last %}mb-3 pb-3 border-bottom{% endif %}">
                                        <div class="d-flex">
                                            <i data-lucide="circle" class="icon-md text-success me-2"></i>
                                            <div>
                                                <h6 class="mb-1">{{ edu.institution_name }}</h6>
                                                <p class="mb-0">
                                                    <span class="text-muted">{{ edu.field_of_study }}</span>
                                                    {% if edu.degree %}
                                                        <span class="badge bg-secondary">{{ edu.degree }}</span>
                                                    {% endif %}
                                                </p>
                                            </div>
                                        </div>
                                        <div class="text-muted tx-13">
                                            {{ edu.start_date|date:"Y年m月" }} -
                                            {% if edu.end_date %}
                                                {{ edu.end_date|date:"Y年m月" }}
                                            {% else %}
                                                至今
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                <!-- 账号安全卡片 -->
                <div class="col-md-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i data-lucide="shield" class="icon-sm"></i> 账号安全
                            </h6>
                            <div class="list-group list-group-flush">
                                <a href="{% url 'accounts:change_password' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center px-0">
                                    <div>
                                        <i data-lucide="lock" class="icon-sm me-2"></i>
                                        <strong>修改密码</strong>
                                        <p class="text-muted tx-13 mb-0">定期更换密码，保护账号安全</p>
                                    </div>
                                    <i data-lucide="chevron-right"></i>
                                </a>
                                <a href="{% url 'accounts:change_email' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center px-0">
                                    <div>
                                        <i data-lucide="mail" class="icon-sm me-2"></i>
                                        <strong>修改邮箱</strong>
                                        <p class="text-muted tx-13 mb-0">当前邮箱：{{ user.email|default:"未设置" }}</p>
                                    </div>
                                    <i data-lucide="chevron-right"></i>
                                </a>
                                <a href="{% url 'accounts:social_connections' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center px-0">
                                    <div>
                                        <i data-lucide="link-2" class="icon-sm me-2"></i>
                                        <strong>社交账号管理</strong>
                                        <p class="text-muted tx-13 mb-0">绑定或解绑第三方登录</p>
                                    </div>
                                    <i data-lucide="chevron-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
