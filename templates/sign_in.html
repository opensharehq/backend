{% extends "auth_base.html" %}

{% block title %}登录{% endblock title %}

{% block auth_content %}
    <h5 class="text-secondary fw-normal mb-4">欢迎回来！请登录您的账号</h5>
    <!-- 社交账号登录 -->
    <div class="mb-4">
        <a href="{% url 'social:begin' 'github' %}" class="btn btn-dark btn-icon-text w-100 mb-2">
            <svg class="btn-icon-prepend" fill="currentColor" viewBox="-3 0 262 262" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="16" height="16">
                <path d="M127.505 0C57.095 0 0 57.085 0 127.505c0 56.336 36.534 104.13 87.196 120.99 6.372 1.18 8.712-2.766 8.712-6.134 0-3.04-.119-13.085-.119-23.698-35.473 7.713-42.958-15.044-42.958-15.044-5.8-14.738-14.157-18.656-14.157-18.656-11.568-7.914.872-7.752.872-7.752 12.804.9 19.546 13.14 19.546 13.14 11.372 19.493 29.828 13.857 37.104 10.6 1.144-8.242 4.449-13.866 8.095-17.05-28.32-3.225-58.092-14.158-58.092-63.014 0-13.92 4.981-25.295 13.138-34.224-1.324-3.212-5.688-16.18 1.235-33.743 0 0 10.707-3.427 35.073 13.07 10.17-2.826 21.078-4.242 31.914-4.29 10.836.048 21.752 1.464 31.942 4.29 24.337-16.497 35.029-13.07 35.029-13.07 6.94 17.563 2.574 30.531 1.25 33.743 8.175 8.929 13.122 20.303 13.122 34.224 0 48.972-29.828 59.756-58.22 62.912 4.573 3.957 8.648 11.717 8.648 23.612 0 17.06-.148 30.791-.148 34.991 0 3.393 2.295 7.369 8.759 6.117 50.634-16.879 87.122-64.656 87.122-120.973C255.009 57.085 197.922 0 127.505 0"></path>
            </svg>
            使用 GitHub 登录
        </a>
        <a href="{% url 'social:begin' 'gitee' %}" class="btn btn-danger btn-icon-text w-100 mb-2">
            <i class="btn-icon-prepend" data-lucide="git-branch"></i>
            使用 Gitee 登录
        </a>
        <!-- <a href="{% url 'social:begin' 'google-oauth2' %}" class="btn btn-outline-danger btn-icon-text w-100 mb-2">
            <i class="btn-icon-prepend" data-lucide="chrome"></i>
            使用 Google 登录
        </a>
        <a href="{% url 'social:begin' 'gitlab' %}" class="btn btn-outline-warning btn-icon-text w-100 mb-2">
            <i class="btn-icon-prepend" data-lucide="gitlab"></i>
            使用 GitLab 登录
        </a> -->
        <a href="{% url 'social:begin' 'huggingface' %}" class="btn btn-outline-primary btn-icon-text w-100 mb-2">
            <i class="btn-icon-prepend" data-lucide="brain"></i>
            使用 HuggingFace 登录
        </a>
    </div>
    <div class="text-center mb-3">
        <span class="text-muted">或</span>
    </div>
    <!-- 邮箱/用户名登录 -->
    <form method="post" id="loginForm" class="forms-sample mb-4">
        {% csrf_token %}
        <div class="mb-3">
            <label for="login-id" class="form-label">邮箱地址或用户名</label>
            <input type="text" class="form-control" id="login-id" name="login-id" placeholder="请输入邮箱地址或用户名" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">密码</label>
            <input type="password" class="form-control" id="password" name="password" autocomplete="current-password" placeholder="请输入密码" required>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="authCheck">
                <label class="form-check-label" for="authCheck">记住我</label>
            </div>
            <a href="{% url 'accounts:password_reset_request' %}" class="text-decoration-none small">忘记密码？</a>
        </div>
        <div>
            <button type="submit" class="btn btn-primary me-2 mb-2 mb-md-0 text-white w-100">
                <i data-lucide="log-in"></i> 登录
            </button>
        </div>
    </form>
    <p class="mt-3 text-secondary">
        还没有账号？
        <a href="{% url 'accounts:sign_up' %}">立即注册</a>
    </p>
{% endblock auth_content %}

{% block extra_js %}
    <script>
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const loginId = document.getElementById('login-id').value;
            const password = document.getElementById('password').value;

            // 检测是邮箱还是用户名
            const isEmail = loginId.includes('@');
            const backend = isEmail ? 'email' : 'username';
            const fieldName = isEmail ? 'email' : 'username';

            // 设置正确的 action URL 和字段名
            this.action = "{% url 'social:begin' 'email' %}".replace('email', backend);
            document.getElementById('login-id').name = fieldName;

            // 提交表单
            this.submit();
        });
    </script>
{% endblock extra_js %}
